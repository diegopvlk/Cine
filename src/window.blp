using Gtk 4.0;
using Adw 1;

template $CineWindow: Adw.ApplicationWindow {
  name: "io-github-diegopvlk-Cine";
  title: _("Cine");
  default-width: 800;
  default-height: 600;
  width-request: 332;
  height-request: 187;

  Adw.Breakpoint breakpoint {
    condition ("max-width: 495sp")

    setters {
      controls_separator.visible: false;
    }
  }

  content: Adw.ToastOverlay toast_overlay {
    WindowHandle {
      Overlay video_overlay {
        styles [
          "video-overlay",
        ]

        [overlay]
        Revealer revealer_icon_indicator {
          transition-duration: 350;
          transition-type: crossfade;

          Image icon_indicator {
            styles [
              "icon-pause-play",
            ]
          }
        }

        [overlay]
        Adw.Spinner spinner {
          halign: center;
          valign: center;
          width-request: 90;
          height-request: 90;
          visible: false;

          styles [
            "cine-spinner",
          ]
        }

        [overlay]
        Revealer revealer_ui {
          transition-duration: 300;
          transition-type: crossfade;

          Box {
            orientation: vertical;

            styles [
              "header-and-controls",
            ]

            Adw.HeaderBar headerbar {
              valign: start;

              styles [
                "osd",
                "header-bar",
              ]

              [start]
              MenuButton open_menu_button {
                valign: center;
                label: _("Open");
                visible: bind start_page.visible inverted;
                always-show-arrow: true;

                menu-model: menu {
                  item {
                    label: _("Open Files");
                    action: "win.clear-and-add";
                  }

                  item {
                    label: _("Open Folder");
                    action: "win.open-folder";
                  }

                  item {
                    label: _("Add Files");
                    action: "win.add-playlist-files";
                  }

                  item {
                    label: _("Add Folder");
                    action: "win.add-playlist-folder";
                  }

                  item {
                    label: _("Add Subtitle Track");
                    action: "win.add-sub-tracks";
                  }

                  item {
                    label: _("Add Audio Track");
                    action: "win.add-audio-tracks";
                  }
                };
              }

              [end]
              MenuButton primary_menu_button {
                valign: center;
                primary: true;
                icon-name: "open-menu-symbolic";
                tooltip-text: _("Main Menu");

                menu-model: menu primary_menu {
                  section {
                    item {
                      label: _("New Window");
                      action: "app.new-window";
                    }

                    item {
                      label: _("Preferences");
                      action: "app.preferences";
                    }

                    item {
                      label: _("Keyboard Shortcuts");
                      action: "win.custom-shortcuts";
                    }

                    item {
                      label: _("About Cine");
                      action: "app.about";
                    }
                  }
                };
              }
            }

            Separator {
              vexpand: true;
              opacity: 0;
            }

            Box controls_box {
              styles [
                "osd",
                "controls",
              ]

              valign: end;
              orientation: vertical;
              visible: false;

              Adw.WrapBox {
                align: 0.5;
                valign: center;
                margin-top: 10;
                margin-start: 13;
                margin-end: 13;
                child-spacing: 4;

                Button previous_button {
                  styles [
                    "circular",
                    "flat",
                  ]

                  icon-name: "cine-skip-backward-symbolic";
                  tooltip-text: _("Previous");
                }

                Button play_pause_button {
                  styles [
                    "circular",
                    "flat",
                  ]

                  icon-name: "cine-playback-start-symbolic";
                  tooltip-text: _("Play/Pause");
                }

                Button next_button {
                  styles [
                    "circular",
                    "flat",
                  ]

                  icon-name: "cine-skip-forward-symbolic";
                  tooltip-text: _("Next");
                }

                MenuButton volume_menu_button {
                  halign: center;
                  icon-name: "cine-volume-max-symbolic";
                  direction: up;
                  tooltip-text: _("Volume");

                  styles [
                    "flat",
                    "circular",
                  ]

                  popover: Popover {
                    Box {
                      ToggleButton mute_toggle_button {
                        icon-name: "cine-volume-mute-symbolic";
                        tooltip-text: _("Mute/Unmute");

                        styles [
                          "flat",
                          "circular",
                        ]
                      }

                      Scale volume_scale {
                        width-request: 180;

                        adjustment: Adjustment volume_scale_adjustment {
                          lower: 0;
                          upper: 130;
                          value: 0;
                        };
                      }
                    }
                  };
                }

                MenuButton subtitles_menu_button {
                  styles [
                    "circular",
                    "flat",
                    "first-label-bold",
                  ]

                  direction: up;
                  halign: center;
                  icon-name: "cine-subtitles-symbolic";
                  tooltip-text: _("Subtitles");

                  menu-model: menu subtitles_menu {};
                }

                MenuButton audio_tracks_menu_button {
                  styles [
                    "circular",
                    "flat",
                    "first-label-bold",
                  ]

                  direction: up;
                  halign: center;
                  icon-name: "cine-audio-symbolic";
                  tooltip-text: _("Audio");

                  menu-model: menu audio_tracks_menu {};
                }

                MenuButton video_tracks_menu_button {
                  styles [
                    "circular",
                    "flat",
                  ]

                  direction: up;
                  halign: center;
                  icon-name: "cine-video-symbolic";
                  tooltip-text: _("Video");

                  menu-model: menu video_tracks_menu {};
                }

                Separator controls_separator {
                  hexpand: true;
                  opacity: 0;
                }

                ToggleButton playlist_shuffle_toggle_button {
                  styles [
                    "circular",
                    "flat",
                  ]

                  icon-name: "cine-playlist-shuffle-symbolic";
                  tooltip-text: _("Shuffle Playlist");
                  valign: end;
                }

                ToggleButton playlist_loop_toggle_button {
                  styles [
                    "circular",
                    "flat",
                  ]

                  icon-name: "cine-playlist-repeat-symbolic";
                  tooltip-text: _("Loop Playlist");
                  valign: end;
                }

                ToggleButton loop_file_toggle_button {
                  styles [
                    "circular",
                    "flat",
                  ]

                  icon-name: "cine-repeat-file-symbolic";
                  tooltip-text: _("Loop File");
                  valign: end;
                }

                Button {
                  styles [
                    "circular",
                    "flat",
                  ]

                  tooltip-text: _("Playlist");
                  icon-name: "cine-playlist-symbolic";
                  valign: end;
                  action-name: "win.open-playlist-dialog";
                }

                $OptionsMenuButton options_menu_button {}

                Button fullscreen_button {
                  styles [
                    "circular",
                    "flat",
                  ]

                  icon-name: "cine-view-fullscreen-symbolic";
                  tooltip-text: _("Fullscreen");
                  valign: end;
                }
              }

              Box {
                valign: center;
                margin-start: 3;
                margin-end: 20;
                margin-bottom: 5;
                height-request: 37;

                Box vid_progress_scale_box {
                  Scale video_progress_scale {
                    halign: fill;
                    hexpand: true;
                    valign: center;
                    margin-start: 8;
                    margin-end: 3;

                    adjustment: Adjustment video_progress_adjustment {
                      lower: 0;
                      upper: 100;
                      value: 0;
                    };
                  }
                }

                Button time_elapsed_button {
                  halign: end;
                  valign: center;
                  clicked => $_toggle_elapsed_remaining();
                  tooltip-text: _("Toggle Elapsed/Remaining");

                  child: Label time_elapsed_label {
                    label: "0:00";
                    width-chars: 5;
                  };

                  styles [
                    "heading",
                    "numeric",
                    "flat",
                    "circular",
                    "time-elapsed",
                  ]
                }

                Separator {
                  styles [
                    "time-separator",
                  ]

                  height-request: 16;
                  width-request: 2;
                  valign: center;
                  margin-start: 10;
                  margin-end: 10;
                }

                Label time_total_label {
                  halign: end;
                  label: "0:00";

                  styles [
                    "heading",
                    "numeric",
                  ]
                }
              }
            }
          }
        }

        [overlay]
        Adw.StatusPage start_page {
          margin-top: 48;
          icon-name: "io.github.diegopvlk.Cine";
          title: _("Drag and Drop Files Here");

          styles [
            "start-page",
          ]

          Box {
            spacing: 12;
            halign: center;
            valign: center;
            orientation: vertical;

            Button {
              label: _("Openâ€¦");
              halign: center;
              action-name: "win.clear-and-add";

              styles [
                "suggested-action",
                "pill",
              ]
            }

            Button {
              label: _("Open Folder");
              action-name: "win.open-folder";

              styles [
                "pill",
              ]
            }
          }
        }

        [overlay]
        Revealer revealer_drop_indicator {
          transition-duration: 200;
          transition-type: crossfade;
          can-focus: false;
          can-target: false;

          Box {
            styles [
              "drop-indicator",
            ]

            homogeneous: true;

            Box {
              valign: center;

              Image drop_icon {
                pixel-size: 64;
              }

              orientation: vertical;
              spacing: 12;

              Label drop_label {
                styles [
                  "title-1",
                ]
              }
            }
          }
        }
      }
    }
  };
}
